{"ast":null,"code":"/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __assign, __decorate, __extends } from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, Classes, Position } from \"../../common\";\nimport { safeInvoke } from \"../../common/utils\";\nimport { Popover } from \"../popover/popover\";\nvar POPPER_MODIFIERS = {\n  preventOverflow: {\n    boundariesElement: \"viewport\"\n  }\n};\nvar TRANSITION_DURATION = 100;\n/* istanbul ignore next */\n\nvar ContextMenu =\n/** @class */\nfunction (_super) {\n  __extends(ContextMenu, _super);\n\n  function ContextMenu() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isDarkTheme: false,\n      isOpen: false,\n      menu: null,\n      offset: null\n    };\n\n    _this.cancelContextMenu = function (e) {\n      return e.preventDefault();\n    };\n\n    _this.handleBackdropContextMenu = function (e) {\n      // React function to remove from the event pool, useful when using a event within a callback\n      e.persist();\n      e.preventDefault(); // wait for backdrop to disappear so we can find the \"real\" element at event coordinates.\n      // timeout duration is equivalent to transition duration so we know it's animated out.\n\n      _this.setTimeout(function () {\n        // retrigger context menu event at the element beneath the backdrop.\n        // if it has a `contextmenu` event handler then it'll be invoked.\n        // if it doesn't, no native menu will show (at least on OSX) :(\n        var newTarget = document.elementFromPoint(e.clientX, e.clientY);\n        newTarget.dispatchEvent(new MouseEvent(\"contextmenu\", e));\n      }, TRANSITION_DURATION);\n    };\n\n    _this.handlePopoverInteraction = function (nextOpenState) {\n      if (!nextOpenState) {\n        // delay the actual hiding till the event queue clears\n        // to avoid flicker of opening twice\n        requestAnimationFrame(function () {\n          return _this.hide();\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  ContextMenu.prototype.render = function () {\n    var _a; // prevent right-clicking in a context menu\n\n\n    var content = React.createElement(\"div\", {\n      onContextMenu: this.cancelContextMenu\n    }, this.state.menu);\n    var popoverClassName = classNames((_a = {}, _a[Classes.DARK] = this.state.isDarkTheme, _a)); // HACKHACK: workaround until we have access to Popper#scheduleUpdate().\n    // https://github.com/palantir/blueprint/issues/692\n    // Generate key based on offset so a new Popover instance is created\n    // when offset changes, to force recomputing position.\n\n    var key = this.state.offset == null ? \"\" : this.state.offset.left + \"x\" + this.state.offset.top; // wrap the popover in a positioned div to make sure it is properly\n    // offset on the screen.\n\n    return React.createElement(\"div\", {\n      className: Classes.CONTEXT_MENU_POPOVER_TARGET,\n      style: this.state.offset\n    }, React.createElement(Popover, __assign({}, this.props, {\n      backdropProps: {\n        onContextMenu: this.handleBackdropContextMenu\n      },\n      content: content,\n      enforceFocus: false,\n      key: key,\n      hasBackdrop: true,\n      isOpen: this.state.isOpen,\n      minimal: true,\n      modifiers: POPPER_MODIFIERS,\n      onInteraction: this.handlePopoverInteraction,\n      position: Position.RIGHT_TOP,\n      popoverClassName: popoverClassName,\n      target: React.createElement(\"div\", null),\n      transitionDuration: TRANSITION_DURATION\n    })));\n  };\n\n  ContextMenu.prototype.show = function (menu, offset, onClose, isDarkTheme) {\n    this.setState({\n      isOpen: true,\n      menu: menu,\n      offset: offset,\n      onClose: onClose,\n      isDarkTheme: isDarkTheme\n    });\n  };\n\n  ContextMenu.prototype.hide = function () {\n    safeInvoke(this.state.onClose);\n    this.setState({\n      isOpen: false,\n      onClose: undefined\n    });\n  };\n\n  ContextMenu = __decorate([polyfill], ContextMenu);\n  return ContextMenu;\n}(AbstractPureComponent2);\n\nvar contextMenuElement;\nvar contextMenu;\n/**\n * Show the given menu element at the given offset from the top-left corner of the viewport.\n * The menu will appear below-right of this point and will flip to below-left if there is not enough\n * room onscreen. The optional callback will be invoked when this menu closes.\n */\n\nexport function show(menu, offset, onClose, isDarkTheme) {\n  if (contextMenuElement == null) {\n    contextMenuElement = document.createElement(\"div\");\n    contextMenuElement.classList.add(Classes.CONTEXT_MENU);\n    document.body.appendChild(contextMenuElement);\n    contextMenu = ReactDOM.render(React.createElement(ContextMenu, {\n      onClosed: remove\n    }), contextMenuElement);\n  }\n\n  contextMenu.show(menu, offset, onClose, isDarkTheme);\n}\n/** Hide the open context menu. */\n\nexport function hide() {\n  if (contextMenu != null) {\n    contextMenu.hide();\n  }\n}\n/** Return whether a context menu is currently open. */\n\nexport function isOpen() {\n  return contextMenu != null && contextMenu.state.isOpen;\n}\n\nfunction remove() {\n  if (contextMenuElement != null) {\n    ReactDOM.unmountComponentAtNode(contextMenuElement);\n    contextMenuElement.remove();\n    contextMenuElement = null;\n    contextMenu = null;\n  }\n}","map":{"version":3,"sources":["../../../../src/components/context-menu/contextMenu.tsx"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;AAgBA,OAAO,UAAP,MAAuB,YAAvB;AACA,OAAO,KAAK,KAAZ,MAAuB,OAAvB;AACA,OAAO,KAAK,QAAZ,MAA0B,WAA1B;AACA,SAAS,QAAT,QAAyB,yBAAzB;AACA,SAAS,sBAAT,EAAiC,OAAjC,EAA0C,QAA1C,QAA0D,cAA1D;AACA,SAAS,UAAT,QAA2B,oBAA3B;AAEA,SAAS,OAAT,QAAwB,oBAAxB;AAgBA,IAAM,gBAAgB,GAAoB;AACtC,EAAA,eAAe,EAAE;AAAE,IAAA,iBAAiB,EAAE;AAArB;AADqB,CAA1C;AAGA,IAAM,mBAAmB,GAAG,GAA5B;AAIA;;AAEA,IAAA,WAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAA0B,EAAA,SAAA,CAAA,WAAA,EAAA,MAAA,CAAA;;AAA1B,WAAA,WAAA,GAAA;AAAA,QAAA,KAAA,GAAA,MAAA,KAAA,IAAA,IAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,IAAA,IAAA;;AACW,IAAA,KAAA,CAAA,KAAA,GAA2B;AAC9B,MAAA,WAAW,EAAE,KADiB;AAE9B,MAAA,MAAM,EAAE,KAFsB;AAG9B,MAAA,IAAI,EAAE,IAHwB;AAI9B,MAAA,MAAM,EAAE;AAJsB,KAA3B;;AAmDC,IAAA,KAAA,CAAA,iBAAA,GAAoB,UAAC,CAAD,EAAwC;AAAK,aAAA,CAAC,CAAD,cAAA,EAAA;AAAkB,KAAnF;;AAEA,IAAA,KAAA,CAAA,yBAAA,GAA4B,UAAC,CAAD,EAAoC;AACpE;AACA,MAAA,CAAC,CAAC,OAAF;AACA,MAAA,CAAC,CAAC,cAAF,GAHoE,CAIpE;AACA;;AACA,MAAA,KAAI,CAAC,UAAL,CAAgB,YAAA;AACZ;AACA;AACA;AACA,YAAM,SAAS,GAAG,QAAQ,CAAC,gBAAT,CAA0B,CAAC,CAAC,OAA5B,EAAqC,CAAC,CAAC,OAAvC,CAAlB;AACA,QAAA,SAAS,CAAC,aAAV,CAAwB,IAAI,UAAJ,CAAe,aAAf,EAA8B,CAA9B,CAAxB;AACH,OAND,EAMG,mBANH;AAOH,KAbO;;AAeA,IAAA,KAAA,CAAA,wBAAA,GAA2B,UAAC,aAAD,EAAuB;AACtD,UAAI,CAAC,aAAL,EAAoB;AAChB;AACA;AACA,QAAA,qBAAqB,CAAC,YAAA;AAAM,iBAAA,KAAI,CAAJ,IAAA,EAAA;AAAW,SAAlB,CAArB;AACH;AACJ,KANO;;;AAOX;;AApEU,EAAA,WAAA,CAAA,SAAA,CAAA,MAAA,GAAP,YAAA;WAAA,CACI;;;AACA,QAAM,OAAO,GAAG,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,MAAA,aAAa,EAAE,KAAK;AAAzB,KAAA,EAA6C,KAAK,KAAL,CAAW,IAAxD,CAAhB;AACA,QAAM,gBAAgB,GAAG,UAAU,EAAA,EAAA,GAAA,EAAA,EAAG,EAAA,CAAC,OAAO,CAAC,IAAT,CAAA,GAAgB,KAAK,KAAL,CAAW,WAA9B,EAAyC,EAAzC,EAAnC,CAHJ,CAKI;AACA;AACA;AACA;;AACA,QAAM,GAAG,GAAG,KAAK,KAAL,CAAW,MAAX,IAAqB,IAArB,GAA4B,EAA5B,GAAoC,KAAK,KAAL,CAAW,MAAX,CAAkB,IAAlB,GAAsB,GAAtB,GAA0B,KAAK,KAAL,CAAW,MAAX,CAAkB,GAA5F,CATJ,CAWI;AACA;;AACA,WACI,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,MAAA,SAAS,EAAE,OAAO,CAAC,2BAAxB;AAAqD,MAAA,KAAK,EAAE,KAAK,KAAL,CAAW;AAAvE,KAAA,EACI,KAAA,CAAA,aAAA,CAAC,OAAD,EAAQ,QAAA,CAAA,EAAA,EACA,KAAK,KADL,EACU;AACd,MAAA,aAAa,EAAE;AAAE,QAAA,aAAa,EAAE,KAAK;AAAtB,OADD;AAEd,MAAA,OAAO,EAAE,OAFK;AAGd,MAAA,YAAY,EAAE,KAHA;AAId,MAAA,GAAG,EAAE,GAJS;AAKd,MAAA,WAAW,EAAE,IALC;AAMd,MAAA,MAAM,EAAE,KAAK,KAAL,CAAW,MANL;AAOd,MAAA,OAAO,EAAE,IAPK;AAQd,MAAA,SAAS,EAAE,gBARG;AASd,MAAA,aAAa,EAAE,KAAK,wBATN;AAUd,MAAA,QAAQ,EAAE,QAAQ,CAAC,SAVL;AAWd,MAAA,gBAAgB,EAAE,gBAXJ;AAYd,MAAA,MAAM,EAAE,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA,IAAA,CAZM;AAad,MAAA,kBAAkB,EAAE;AAbN,KADV,CAAR,CADJ,CADJ;AAoBH,GAjCM;;AAmCA,EAAA,WAAA,CAAA,SAAA,CAAA,IAAA,GAAP,UAAY,IAAZ,EAA+B,MAA/B,EAAgD,OAAhD,EAAsE,WAAtE,EAA2F;AACvF,SAAK,QAAL,CAAc;AAAE,MAAA,MAAM,EAAE,IAAV;AAAgB,MAAA,IAAI,EAAA,IAApB;AAAsB,MAAA,MAAM,EAAA,MAA5B;AAA8B,MAAA,OAAO,EAAA,OAArC;AAAuC,MAAA,WAAW,EAAA;AAAlD,KAAd;AACH,GAFM;;AAIA,EAAA,WAAA,CAAA,SAAA,CAAA,IAAA,GAAP,YAAA;AACI,IAAA,UAAU,CAAC,KAAK,KAAL,CAAW,OAAZ,CAAV;AACA,SAAK,QAAL,CAAc;AAAE,MAAA,MAAM,EAAE,KAAV;AAAiB,MAAA,OAAO,EAAE;AAA1B,KAAd;AACH,GAHM;;AA/CL,EAAA,WAAW,GAAA,UAAA,CAAA,CADhB,QACgB,CAAA,EAAX,WAAW,CAAX;AA4EN,SAAA,WAAA;AAAC,CA5ED,CAA0B,sBAA1B,CAAA;;AA8EA,IAAI,kBAAJ;AACA,IAAI,WAAJ;AAEA;;;;;;AAKA,OAAM,SAAU,IAAV,CAAe,IAAf,EAAkC,MAAlC,EAAmD,OAAnD,EAAyE,WAAzE,EAA8F;AAChG,MAAI,kBAAkB,IAAI,IAA1B,EAAgC;AAC5B,IAAA,kBAAkB,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAArB;AACA,IAAA,kBAAkB,CAAC,SAAnB,CAA6B,GAA7B,CAAiC,OAAO,CAAC,YAAzC;AACA,IAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,kBAA1B;AACA,IAAA,WAAW,GAAG,QAAQ,CAAC,MAAT,CACV,KAAA,CAAA,aAAA,CAAC,WAAD,EAAY;AAAC,MAAA,QAAQ,EAAE;AAAX,KAAZ,CADU,EAEV,kBAFU,CAAd;AAIH;;AAED,EAAA,WAAW,CAAC,IAAZ,CAAiB,IAAjB,EAAuB,MAAvB,EAA+B,OAA/B,EAAwC,WAAxC;AACH;AAED;;AACA,OAAM,SAAU,IAAV,GAAc;AAChB,MAAI,WAAW,IAAI,IAAnB,EAAyB;AACrB,IAAA,WAAW,CAAC,IAAZ;AACH;AACJ;AAED;;AACA,OAAM,SAAU,MAAV,GAAgB;AAClB,SAAO,WAAW,IAAI,IAAf,IAAuB,WAAW,CAAC,KAAZ,CAAkB,MAAhD;AACH;;AAED,SAAS,MAAT,GAAe;AACX,MAAI,kBAAkB,IAAI,IAA1B,EAAgC;AAC5B,IAAA,QAAQ,CAAC,sBAAT,CAAgC,kBAAhC;AACA,IAAA,kBAAkB,CAAC,MAAnB;AACA,IAAA,kBAAkB,GAAG,IAArB;AACA,IAAA,WAAW,GAAG,IAAd;AACH;AACJ","sourceRoot":"","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __assign, __decorate, __extends } from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, Classes, Position } from \"../../common\";\nimport { safeInvoke } from \"../../common/utils\";\nimport { Popover } from \"../popover/popover\";\nvar POPPER_MODIFIERS = {\n    preventOverflow: { boundariesElement: \"viewport\" },\n};\nvar TRANSITION_DURATION = 100;\n/* istanbul ignore next */\nvar ContextMenu = /** @class */ (function (_super) {\n    __extends(ContextMenu, _super);\n    function ContextMenu() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            isDarkTheme: false,\n            isOpen: false,\n            menu: null,\n            offset: null,\n        };\n        _this.cancelContextMenu = function (e) { return e.preventDefault(); };\n        _this.handleBackdropContextMenu = function (e) {\n            // React function to remove from the event pool, useful when using a event within a callback\n            e.persist();\n            e.preventDefault();\n            // wait for backdrop to disappear so we can find the \"real\" element at event coordinates.\n            // timeout duration is equivalent to transition duration so we know it's animated out.\n            _this.setTimeout(function () {\n                // retrigger context menu event at the element beneath the backdrop.\n                // if it has a `contextmenu` event handler then it'll be invoked.\n                // if it doesn't, no native menu will show (at least on OSX) :(\n                var newTarget = document.elementFromPoint(e.clientX, e.clientY);\n                newTarget.dispatchEvent(new MouseEvent(\"contextmenu\", e));\n            }, TRANSITION_DURATION);\n        };\n        _this.handlePopoverInteraction = function (nextOpenState) {\n            if (!nextOpenState) {\n                // delay the actual hiding till the event queue clears\n                // to avoid flicker of opening twice\n                requestAnimationFrame(function () { return _this.hide(); });\n            }\n        };\n        return _this;\n    }\n    ContextMenu.prototype.render = function () {\n        var _a;\n        // prevent right-clicking in a context menu\n        var content = React.createElement(\"div\", { onContextMenu: this.cancelContextMenu }, this.state.menu);\n        var popoverClassName = classNames((_a = {}, _a[Classes.DARK] = this.state.isDarkTheme, _a));\n        // HACKHACK: workaround until we have access to Popper#scheduleUpdate().\n        // https://github.com/palantir/blueprint/issues/692\n        // Generate key based on offset so a new Popover instance is created\n        // when offset changes, to force recomputing position.\n        var key = this.state.offset == null ? \"\" : this.state.offset.left + \"x\" + this.state.offset.top;\n        // wrap the popover in a positioned div to make sure it is properly\n        // offset on the screen.\n        return (React.createElement(\"div\", { className: Classes.CONTEXT_MENU_POPOVER_TARGET, style: this.state.offset },\n            React.createElement(Popover, __assign({}, this.props, { backdropProps: { onContextMenu: this.handleBackdropContextMenu }, content: content, enforceFocus: false, key: key, hasBackdrop: true, isOpen: this.state.isOpen, minimal: true, modifiers: POPPER_MODIFIERS, onInteraction: this.handlePopoverInteraction, position: Position.RIGHT_TOP, popoverClassName: popoverClassName, target: React.createElement(\"div\", null), transitionDuration: TRANSITION_DURATION }))));\n    };\n    ContextMenu.prototype.show = function (menu, offset, onClose, isDarkTheme) {\n        this.setState({ isOpen: true, menu: menu, offset: offset, onClose: onClose, isDarkTheme: isDarkTheme });\n    };\n    ContextMenu.prototype.hide = function () {\n        safeInvoke(this.state.onClose);\n        this.setState({ isOpen: false, onClose: undefined });\n    };\n    ContextMenu = __decorate([\n        polyfill\n    ], ContextMenu);\n    return ContextMenu;\n}(AbstractPureComponent2));\nvar contextMenuElement;\nvar contextMenu;\n/**\n * Show the given menu element at the given offset from the top-left corner of the viewport.\n * The menu will appear below-right of this point and will flip to below-left if there is not enough\n * room onscreen. The optional callback will be invoked when this menu closes.\n */\nexport function show(menu, offset, onClose, isDarkTheme) {\n    if (contextMenuElement == null) {\n        contextMenuElement = document.createElement(\"div\");\n        contextMenuElement.classList.add(Classes.CONTEXT_MENU);\n        document.body.appendChild(contextMenuElement);\n        contextMenu = ReactDOM.render(React.createElement(ContextMenu, { onClosed: remove }), contextMenuElement);\n    }\n    contextMenu.show(menu, offset, onClose, isDarkTheme);\n}\n/** Hide the open context menu. */\nexport function hide() {\n    if (contextMenu != null) {\n        contextMenu.hide();\n    }\n}\n/** Return whether a context menu is currently open. */\nexport function isOpen() {\n    return contextMenu != null && contextMenu.state.isOpen;\n}\nfunction remove() {\n    if (contextMenuElement != null) {\n        ReactDOM.unmountComponentAtNode(contextMenuElement);\n        contextMenuElement.remove();\n        contextMenuElement = null;\n        contextMenu = null;\n    }\n}\n//# sourceMappingURL=contextMenu.js.map"]},"metadata":{},"sourceType":"module"}